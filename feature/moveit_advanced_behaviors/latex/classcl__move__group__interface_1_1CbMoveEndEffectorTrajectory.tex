\hypertarget{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory}{}\section{cl\+\_\+move\+\_\+group\+\_\+interface\+:\+:Cb\+Move\+End\+Effector\+Trajectory Class Reference}
\label{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory}\index{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}}


{\ttfamily \#include $<$cb\+\_\+move\+\_\+end\+\_\+effector\+\_\+trajectory.\+h$>$}



Inheritance diagram for cl\+\_\+move\+\_\+group\+\_\+interface\+:\+:Cb\+Move\+End\+Effector\+Trajectory\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for cl\+\_\+move\+\_\+group\+\_\+interface\+:\+:Cb\+Move\+End\+Effector\+Trajectory\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_ae0a2197aae29ec2a5842e94014ba2065}{Cb\+Move\+End\+Effector\+Trajectory} (const std\+::vector$<$ geometry\+\_\+msgs\+::\+Pose\+Stamped $>$ \&end\+Effector\+Trajectory)
\item 
virtual void \hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aaedd074fd178c6390a4a3f1ccff23ad3}{on\+Entry} () override
\item 
std\+::future$<$ moveit\+::planning\+\_\+interface\+::\+Move\+It\+Error\+Code $>$ \hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_a8490f52e1f8cb280657965b544bfed30}{plan\+And\+Execute\+Async} ()
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
boost\+::optional$<$ std\+::string $>$ \hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aa247cf74c1d4878bacecba836a839fa7}{group\+\_\+}
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::vector$<$ geometry\+\_\+msgs\+::\+Pose\+Stamped $>$ \hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_ae13dfd31ea3660646e03882f0c2c29f0}{end\+Effector\+Trajectory\+\_\+}
\item 
\hyperlink{classcl__move__group__interface_1_1ClMoveGroup}{Cl\+Move\+Group} $\ast$ \hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aea650d3e7836125b32be97392b71a7f3}{movegroup\+Client\+\_\+}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 14 of file cb\+\_\+move\+\_\+end\+\_\+effector\+\_\+trajectory.\+h.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_ae0a2197aae29ec2a5842e94014ba2065}\label{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_ae0a2197aae29ec2a5842e94014ba2065}} 
\index{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}!Cb\+Move\+End\+Effector\+Trajectory@{Cb\+Move\+End\+Effector\+Trajectory}}
\index{Cb\+Move\+End\+Effector\+Trajectory@{Cb\+Move\+End\+Effector\+Trajectory}!cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}}
\subsubsection{\texorpdfstring{Cb\+Move\+End\+Effector\+Trajectory()}{CbMoveEndEffectorTrajectory()}}
{\footnotesize\ttfamily cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory\+::\+Cb\+Move\+End\+Effector\+Trajectory (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ geometry\+\_\+msgs\+::\+Pose\+Stamped $>$ \&}]{end\+Effector\+Trajectory }\end{DoxyParamCaption})}



Definition at line 12 of file cb\+\_\+move\+\_\+end\+\_\+effector\+\_\+trajectory.\+cpp.


\begin{DoxyCode}
13         : \hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_ae13dfd31ea3660646e03882f0c2c29f0}{endEffectorTrajectory\_}(endEffectorTrajectory)
14 
15     \{
16     \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aaedd074fd178c6390a4a3f1ccff23ad3}\label{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aaedd074fd178c6390a4a3f1ccff23ad3}} 
\index{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}!on\+Entry@{on\+Entry}}
\index{on\+Entry@{on\+Entry}!cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}}
\subsubsection{\texorpdfstring{on\+Entry()}{onEntry()}}
{\footnotesize\ttfamily void cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory\+::on\+Entry (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \hyperlink{classsmacc_1_1ISmaccClientBehavior_a3ec24a839087c550e1d62a81e48cf530}{smacc\+::\+I\+Smacc\+Client\+Behavior}.



Definition at line 18 of file cb\+\_\+move\+\_\+end\+\_\+effector\+\_\+trajectory.\+cpp.



References smacc\+::\+I\+Smacc\+Client\+Behavior\+::current\+State, end\+Effector\+Trajectory\+\_\+, movegroup\+Client\+\_\+, cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cl\+Move\+Group\+::move\+Group\+Client\+Interface, smacc\+::\+I\+Smacc\+Client\+Behavior\+::requires\+Client(), and battery\+\_\+monitor\+\_\+node\+::t.


\begin{DoxyCode}
19     \{
20         moveit::planning\_interface::MoveGroupInterface::Plan computedMotionPlan;
21 
22         this->\hyperlink{classsmacc_1_1ISmaccClientBehavior_a32b16e99e3b4cb289414203dc861a440}{requiresClient}(\hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aea650d3e7836125b32be97392b71a7f3}{movegroupClient\_});
23         \textcolor{comment}{// get current robot state}
24         \textcolor{keyword}{auto} \hyperlink{classsmacc_1_1ISmaccClientBehavior_a5a6658a2deb72b700ae595e594617616}{currentState} = \hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aea650d3e7836125b32be97392b71a7f3}{movegroupClient\_}->
      \hyperlink{classcl__move__group__interface_1_1ClMoveGroup_a92922ea689e4e1b7b91512c56629c95b}{moveGroupClientInterface}.getCurrentState();
25 
26         \textcolor{comment}{// get the IK client}
27         ros::NodeHandle nh;
28         \textcolor{keyword}{auto} iksrv = nh.serviceClient<moveit\_msgs::GetPositionIK>(\textcolor{stringliteral}{"/compute\_ik"});
29         \textcolor{keyword}{auto} groupname = \hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aea650d3e7836125b32be97392b71a7f3}{movegroupClient\_}->
      \hyperlink{classcl__move__group__interface_1_1ClMoveGroup_a92922ea689e4e1b7b91512c56629c95b}{moveGroupClientInterface}.getName();
30         \textcolor{keyword}{auto} currentjointnames = \hyperlink{classsmacc_1_1ISmaccClientBehavior_a5a6658a2deb72b700ae595e594617616}{currentState}->getJointModelGroup(groupname)->
      getActiveJointModelNames();
31 
32         std::vector<double> jointPositions;
33         \hyperlink{classsmacc_1_1ISmaccClientBehavior_a5a6658a2deb72b700ae595e594617616}{currentState}->copyJointGroupPositions(groupname, jointPositions);
34 
35         std::vector<std::vector<double>> trajectory;
36         trajectory.push\_back(jointPositions);
37 
38         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < this->\hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_ae13dfd31ea3660646e03882f0c2c29f0}{endEffectorTrajectory\_}.size(); k++)
39         \{
40             \textcolor{keyword}{auto} &pose = this->\hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_ae13dfd31ea3660646e03882f0c2c29f0}{endEffectorTrajectory\_}[k];
41             moveit\_msgs::GetPositionIKRequest req;
42             req.ik\_request.robot\_state.joint\_state.name = currentjointnames;
43             req.ik\_request.robot\_state.joint\_state.position = jointPositions;
44 
45             req.ik\_request.group\_name = groupname;
46             req.ik\_request.avoid\_collisions = \textcolor{keyword}{true};
47 
48             moveit\_msgs::GetPositionIKResponse res;
49 
50             pose.header.stamp = ros::Time::now();
51             req.ik\_request.pose\_stamped = pose;
52 
53             ROS\_WARN\_STREAM(\textcolor{stringliteral}{"IK request: "} << req);
54             \textcolor{keywordflow}{if} (iksrv.call(req, res))
55             \{
56                 \textcolor{keyword}{auto} &prevtrajpoint = trajectory.back();
57                 \textcolor{comment}{//jointPositions.clear();}
58 
59                 std::stringstream ss;
60                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < res.solution.joint\_state.position.size(); j++)
61                 \{
62                     \textcolor{keyword}{auto} &jointname = res.solution.joint\_state.name[j];
63                     \textcolor{keyword}{auto} it = std::find(currentjointnames.begin(), currentjointnames.end(), jointname);
64                     \textcolor{keywordflow}{if} (it != currentjointnames.end())
65                     \{
66                         \textcolor{keywordtype}{int} index = std::distance(currentjointnames.begin(), it);
67                         jointPositions[index] = res.solution.joint\_state.position[j];
68                         ss << jointname << \textcolor{stringliteral}{"("} << index << \textcolor{stringliteral}{"): "} << jointPositions[index] << std::endl;
69                     \}
70                 \}
71 
72                 \textcolor{comment}{// continuity check}
73                 \textcolor{keywordtype}{bool} discontinuity = \textcolor{keyword}{false};
74                 \textcolor{keywordflow}{if}(k!=0)
75                 \{
76                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < jointPositions.size(); j++)
77                     \{
78                         \textcolor{keyword}{auto} deltajoint = jointPositions[j] - prevtrajpoint[j];
79 
80                         \textcolor{keywordflow}{if} (fabs(deltajoint) > 0.07 \textcolor{comment}{/*2 deg*/})
81                         \{
82                             discontinuity = \textcolor{keyword}{true};
83                             ROS\_ERROR\_STREAM(\textcolor{stringliteral}{"IK discontinuity "} << currentjointnames[j] << \textcolor{stringliteral}{" : "} << 
      deltajoint );
84                             \textcolor{keywordflow}{break};
85                         \}
86                     \}
87                 \}
88 
89                 \textcolor{keywordflow}{if} (discontinuity)
90                 \{
91                     k--;
92                     ROS\_ERROR(\textcolor{stringliteral}{"IK discontinuity detected, retrying"});
93                 \}
94                 \textcolor{keywordflow}{else}
95                 \{
96                     trajectory.push\_back(jointPositions);
97                     ROS\_WARN\_STREAM(\textcolor{stringliteral}{"IK solution: "} << res.solution.joint\_state);
98                     ROS\_WARN\_STREAM(\textcolor{stringliteral}{"trajpoint: "} << std::endl
99                                                   << ss.str());
100                 \}
101             \}
102             \textcolor{keywordflow}{else}
103             \{
104                 ROS\_ERROR(\textcolor{stringliteral}{"[CbMoveEndEffectorTrajectory] wrong IK call"});
105             \}
106 
107             ROS\_WARN\_STREAM(\textcolor{stringliteral}{"-----"});
108         \}
109 
110         \textcolor{comment}{// interpolate speeds?}
111 
112         \textcolor{comment}{// interpolate accelerations?}
113 
114         \textcolor{comment}{// get current robot state}
115         \textcolor{comment}{// fill plan message}
116         computedMotionPlan.start\_state\_.joint\_state.name = currentjointnames;
117 
118         computedMotionPlan.start\_state\_.joint\_state.position = trajectory.front();
119         computedMotionPlan.trajectory\_.joint\_trajectory.joint\_names = currentjointnames;
120 
121         \textcolor{keywordtype}{double} \hyperlink{namespacebattery__monitor__node_a7a63d20d1ea461e280f4eb5b47f925cd}{t} = 0;
122         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} &p : trajectory)
123         \{
124             trajectory\_msgs::JointTrajectoryPoint jp;
125             jp.positions = p;
126             jp.time\_from\_start = ros::Duration(t);
127             t += 1.0;
128             computedMotionPlan.trajectory\_.joint\_trajectory.points.push\_back(jp);
129         \}
130 
131         \textcolor{comment}{// call execute}
132         this->\hyperlink{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aea650d3e7836125b32be97392b71a7f3}{movegroupClient\_}->\hyperlink{classcl__move__group__interface_1_1ClMoveGroup_a92922ea689e4e1b7b91512c56629c95b}{moveGroupClientInterface}.execute(
      computedMotionPlan.trajectory\_);
133 
134         \textcolor{comment}{// handle finishing events}
135     \}
\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aaedd074fd178c6390a4a3f1ccff23ad3_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_a8490f52e1f8cb280657965b544bfed30}\label{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_a8490f52e1f8cb280657965b544bfed30}} 
\index{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}!plan\+And\+Execute\+Async@{plan\+And\+Execute\+Async}}
\index{plan\+And\+Execute\+Async@{plan\+And\+Execute\+Async}!cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}}
\subsubsection{\texorpdfstring{plan\+And\+Execute\+Async()}{planAndExecuteAsync()}}
{\footnotesize\ttfamily std\+::future$<$moveit\+::planning\+\_\+interface\+::\+Move\+It\+Error\+Code$>$ cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory\+::plan\+And\+Execute\+Async (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



\subsection{Member Data Documentation}
\mbox{\Hypertarget{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_ae13dfd31ea3660646e03882f0c2c29f0}\label{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_ae13dfd31ea3660646e03882f0c2c29f0}} 
\index{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}!end\+Effector\+Trajectory\+\_\+@{end\+Effector\+Trajectory\+\_\+}}
\index{end\+Effector\+Trajectory\+\_\+@{end\+Effector\+Trajectory\+\_\+}!cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}}
\subsubsection{\texorpdfstring{end\+Effector\+Trajectory\+\_\+}{endEffectorTrajectory\_}}
{\footnotesize\ttfamily std\+::vector$<$geometry\+\_\+msgs\+::\+Pose\+Stamped$>$ cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory\+::end\+Effector\+Trajectory\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line 29 of file cb\+\_\+move\+\_\+end\+\_\+effector\+\_\+trajectory.\+h.



Referenced by on\+Entry().

\mbox{\Hypertarget{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aa247cf74c1d4878bacecba836a839fa7}\label{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aa247cf74c1d4878bacecba836a839fa7}} 
\index{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}!group\+\_\+@{group\+\_\+}}
\index{group\+\_\+@{group\+\_\+}!cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}}
\subsubsection{\texorpdfstring{group\+\_\+}{group\_}}
{\footnotesize\ttfamily boost\+::optional$<$std\+::string$>$ cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory\+::group\+\_\+}



Definition at line 19 of file cb\+\_\+move\+\_\+end\+\_\+effector\+\_\+trajectory.\+h.

\mbox{\Hypertarget{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aea650d3e7836125b32be97392b71a7f3}\label{classcl__move__group__interface_1_1CbMoveEndEffectorTrajectory_aea650d3e7836125b32be97392b71a7f3}} 
\index{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}!movegroup\+Client\+\_\+@{movegroup\+Client\+\_\+}}
\index{movegroup\+Client\+\_\+@{movegroup\+Client\+\_\+}!cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory@{cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory}}
\subsubsection{\texorpdfstring{movegroup\+Client\+\_\+}{movegroupClient\_}}
{\footnotesize\ttfamily \hyperlink{classcl__move__group__interface_1_1ClMoveGroup}{Cl\+Move\+Group}$\ast$ cl\+\_\+move\+\_\+group\+\_\+interface\+::\+Cb\+Move\+End\+Effector\+Trajectory\+::movegroup\+Client\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line 31 of file cb\+\_\+move\+\_\+end\+\_\+effector\+\_\+trajectory.\+h.



Referenced by on\+Entry().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
smacc\+\_\+client\+\_\+library/move\+\_\+group\+\_\+interface\+\_\+client/include/move\+\_\+group\+\_\+interface\+\_\+client/client\+\_\+behaviors/\hyperlink{cb__move__end__effector__trajectory_8h}{cb\+\_\+move\+\_\+end\+\_\+effector\+\_\+trajectory.\+h}\item 
smacc\+\_\+client\+\_\+library/move\+\_\+group\+\_\+interface\+\_\+client/src/move\+\_\+group\+\_\+interface\+\_\+client/client\+\_\+behaviors/\hyperlink{cb__move__end__effector__trajectory_8cpp}{cb\+\_\+move\+\_\+end\+\_\+effector\+\_\+trajectory.\+cpp}\end{DoxyCompactItemize}
