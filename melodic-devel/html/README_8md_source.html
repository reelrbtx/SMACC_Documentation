<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SMACC: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SMACC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="README_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;## Travis CI: </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;| ROS Distro  | Travis Build Status | Documentation |</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;| ------------- | ------------- | ------------- |</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;| Indigo  | &lt;a src=&quot;https://travis-ci.org/reelrbtx/SMACC&quot;&gt;&lt;img src=&quot;https://travis-ci.com/reelrbtx/SMACC.svg?branch=indigo-devel&quot;/&gt; &lt;/a&gt;|  &lt;a href=&quot;https://reelrbtx.github.io/SMACC/indigo-devel/html/md_README.html&quot;&gt;doxygen&lt;/a&gt;|</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;| Kinetic  | &lt;a src=&quot;https://travis-ci.org/reelrbtx/SMACC&quot;&gt;&lt;img src=&quot;https://travis-ci.com/reelrbtx/SMACC.svg?branch=kinetic-devel&quot;/&gt;&lt;/a&gt;  | &lt;a href=&quot;https://reelrbtx.github.io/SMACC/kinetic-devel/html/md_README.html&quot;&gt;doxygen&lt;/a&gt;|</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;| Melodic  | &lt;a src=&quot;https://travis-ci.org/reelrbtx/SMACC&quot;&gt;&lt;img src=&quot;https://travis-ci.com/reelrbtx/SMACC.svg?branch=melodic-devel&quot;/&gt;&lt;/a&gt;  | &lt;a href=&quot;https://reelrbtx.github.io/SMACC/melodic-devel/html/md_README.html&quot;&gt;doxygen&lt;/a&gt;|</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;| Master  | &lt;a src=&quot;https://travis-ci.org/reelrbtx/SMACC&quot;&gt;&lt;img src=&quot;https://travis-ci.com/reelrbtx/SMACC.svg?branch=master&quot;/&gt;&lt;/a&gt; | &lt;a href=&quot;https://reelrbtx.github.io/SMACC_Documentation/master/html/namespaces.html&quot;&gt;doxygen&lt;/a&gt;|</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;## Docker Containers</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;[![Docker Automated build](https://img.shields.io/docker/automated/pabloinigoblasco/smacc.svg?maxAge=2592000)](https://hub.docker.com/r/pabloinigoblasco/smacc/) [![Docker Pulls](https://img.shields.io/docker/pulls/pabloinigoblasco/smacc.svg?maxAge=2592000)](https://hub.docker.com/r/pabloinigoblasco/smacc/) [![Docker Stars](https://img.shields.io/docker/stars/pabloinigoblasco/smacc.svg)](https://registry.hub.docker.com/pabloinigoblasco/smacc/)</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;# &lt;img src=&quot;http://smacc.ninja/wp-content/uploads/2019/07/SMACC-Logo-Pixelate-4-copy.png&quot; width=&quot;30&quot; align=&quot;left&quot;/&gt; SMACC</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;SMACC is an event-driven, asynchronous, behavioral state machine library for real-time ROS (Robotic Operating System) applications written in C++, designed to allow programmers to build robot control applications for multicomponent robots, in an intuitive and systematic manner. </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;SMACC is inspired by the [SMACH ROS package](http://wiki.ros.org/smach) and it is built on top of [Boost StateChart library](https://www.boost.org/doc/libs/1_53_0/libs/statechart/doc/index.html).</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;Probably the greatest strength of SMACC is that it offers out-of-the-box reference state machines, (found in the folder [sm_reference_library](https://github.com/reelrbtx/SMACC/tree/master/smacc_sm_reference_library))  that you can use, test, hack, and customize to quickly get your application up and running, while also knowing that the library supports advanced functionalities that are practically universal among actual working robots.</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;## Features</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; *  ***Powered by ROS:*** SMACC has been developed specifically to work with ROS. It is a c++ ros package that can be imported from any end-user application package.</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; *   ***Written in C++:*** Until now, ROS has lacked a library to develop task-level state machines in C++. Although libraries have been developed in scripting languages such as python, these are unsuitable for real-world industrial evironments where real-time requirements are demanded.</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; *  ***Static State Machine Checking:*** SMACC inherits this from the Boost Statechart library which helps the developer to check the consistency of the state machine at compile time (instead of runtime).</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; * ***Component based architecture:*** SMACC has built-in funcionality provided inside SMACC Components that can be dynamically imported at runtime and stored in the local machine. The states only access those components they are concerned with. This enables the SMACC based application to extend or improve the runtime behavior of the system.</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;## SMACC applications</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;From it&#39;s inception, SMACC was written to support the programming of multi-component, complex robots. If your project involves small, solar-powered insect robots, that simply navigate towards a light source, then SMACC might not be the right choice for you. But if you are trying to program a robot with a mobile base, a robotic arm, a gripper, two lidar sensors, a gps transceiver and an imu, then you&#39;ve come to the right place. </div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;## ROS Integration</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;* ***Intensive use of ROS Action***. SMACC translates Action server events (Result callbacks, Feedback callbacks, etc.) into statechart events. To learn more about this, check the sections Shared Resources and SMACC Architecture.</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;* ***Powerful access to ROS Parameters***. Each SMACC state automatically creates a ros::NodeHandle automatically named according to the SMACC state hierarchy (see more in section Usage Examples - Ros parameters)</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;* ***ROS Navigation built-in funcionality***. SMACC extends the ROS navigation stack in a high level way. It provides specialized navigation planners (for the ROS Navigation Stack) that navigate only using pure spinning motions and straight motions. Implements some mechanism to perform motions recording the path and undoing them later.</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;These can be very useful in some industrial applications where the knowledge or certainty on the environment is higher (ros planners are focused on cluttered and dynamic environments).</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;## Repository Packages</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;This repository contains several ROS packages:</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; * **smacc_core**: The core smacc library. It works as a template-based c++  header library.</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; * **smacc_navigation**: a set of ros packages with some &quot;Smacc Components&quot; that ease the creation of high level navigation applications. The provided components remotelly control the move_base. These components helps in the creation of complex motion strategies (changing planners, recording and undoing paths, etc.)</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; * **smacc_state_machine_templates**: shows a complete sample application developed with SMACC that can be reused as a canonical example of a mobile robot moving around and interacting with a custom onboard tool.</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; * **smacc_interface_components**: template project that shows how an on/off tool onboard the mobile robot could be used following the SMACC methodology.</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;## Future Work</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; * undoing paths chunks by state (store the different chunks of the path according to its state in a stack)</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; * code generation based on uml diagrams</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; * improving backwards planners for non linear paths</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;## Shared Resources and Shared variables</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;* ***Shared Action Client Resources*** Action servers in SMACC play an important role because all low-level funcionality must be located on them. In order to interact with these Action Servers SMACC provide an easy way to create shared ActionClients that can be accessed from any State. SMACC is in charge of eficently handle all the requests and send the resulting events from action servers (result messages, feedback messages, etc) to the &quot;subscribed states&quot; in form of statechart events. (See more about his in section internal architecture)</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;* ***Shared Variables*** UML statecharts basically define the high level behavior of a system. However, in practice the real state of the system may be much more complex (mesurement, environment numerical information, etc.). States usually have to share information (or comunicate to each other). In order to do that, SMACC implements a  simple but effective dictionary-based mechanism to share information (structs, objects, simple variables or pointers). (See below in tutorials: shared variable)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;&lt;p align=&quot;center&quot;&gt;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;&lt;img src=&quot;https://github.com//brettpac/SMACC/blob/master/documentation/shared_resources.png?raw=true&quot;  width=&quot;450&quot; align=&quot;center&quot;/&gt;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;## Development methodology</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;SMACC also defines a development methodology where State Machine nodes only contain the task-level logic, that is, the high level behavior of the robot system in some specific application.</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;SMACC applications have low level coupling with other software components of the robot system. SMACC code is recomended to interact with the rest of components the robot system via ROS Action Servers and **Smacc Action Plugins**.</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;The proposed methdology split the states into 2 or more statechart orthogonal lines that comunicate to each other via events. The orthogonal line 0 is tipically for the mobile robot navigation. The second orthogonal line and ahead are used for tools (manipulators, grippers or other custom tools).</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;&lt;p align=&quot;center&quot;&gt;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;&lt;img src=&quot;https://github.com/reelrbtx/SMACC/blob/master/documentation/SMACC-Containers-3.jpg&quot;  width=&quot;450&quot; align=&quot;center&quot;/&gt;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;## Internal Architecture</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;SMACC State Machines are boost::statechart AsynchronousStateMachines that can work in a multi-threaded application. In SMACC State Machines are two main components that work concurrently in two different threads:</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;* ***Signal Detector***. It is able to handle the action client components communication with action servers and translate them to statechart events</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;* ***State Machine***. It is the end-user code of the state machine itself.</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;&lt;p align=&quot;center&quot;&gt;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;&lt;img src=&quot;http://smacc.ninja/wp-content/uploads/2018/09/SMACC-Node-Map-2-2-1.jpg&quot;  width=&quot;450&quot; align=&quot;center&quot;/&gt;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;## Executing the Radial Motion Example</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;This is a complete sample of a state machine that controls the motion of a simulated ridgeback mobile robot in gazebo.</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;This example shows how smacc::Navigation components can be used to create some systematic motion based on an state machine. The robot performs a motion pattern that plots a &quot;Start&quot; on the plane. The state machine in the motion is combined with the usage of some external tool &quot;for example ground painter&quot; that is only active on forward motions.</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;```</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;export RIDGEBACK_URDF_EXTRAS=$(rospack find radial_motion_example)/urdf/empty.xacro</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;roslaunch radial_motion_example radial_motion.launch</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;```</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;&lt;p align=&quot;center&quot;&gt;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;&lt;div style=&quot;float:left&quot; align=&quot;center&quot;&gt;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;&lt;img src=&quot;https://raw.githubusercontent.com/brettpac/SMACC/master/documentation/radial_motion_example.png&quot; width=&quot;400&quot;/&gt;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;&lt;div style=&quot;float:left&quot; align=&quot;center&quot;&gt;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;&lt;img src=&quot;https://raw.githubusercontent.com/brettpac/SMACC/master/documentation/radial_motion_example_statechart.png&quot; width=&quot;400&quot;/&gt;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;&lt;/div&gt;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;# Tutorial</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;SMACC states inherits from boost::statechart:State so that you can learn the full potential of SMACC states also diving in the statechart documentation. However, the following examples briefly show how you create define SMACC states and how you would usually use them.</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;## Code a minimal SMACC StateMachine</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;In this initial example we will implement a simple state machine with a single state state that executes something at state entry and at state exit. That state machine is described in the following image:</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;&lt;p align=&quot;center&quot;&gt;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;&lt;img src=&quot;https://raw.githubusercontent.com/brettpac/SMACC/master/documentation/simpleStateMachine.png&quot; width=&quot;450&quot;/&gt;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;SMACC StateMachines and SmaccStates are based on the c++ [Curiously recurring template pattern](https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern) so that the syntax may be strange for some developers but you will notice that it is very easy to follow. The advantage of using this kind of c++ pattern is that the definition of the state machine is correctly written.</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;The following chunk of code shows the minimal SMACC State machine you can create:</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;```cpp</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;#include &lt;smacc/smacc_state_machine_base.h&gt;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;struct SimpleStateMachine</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    : public SmaccStateMachineBase&lt;SimpleStateMachine,ToolSimpleState&gt;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  using SmaccState::SmaccState;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  void onEntry()</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;};</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;```</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;Every SMACC State Machine must inherit from SmaccStateMachineBase. The first template parameter is the derived class type (SimpleStateMachine itself) according to the curiosuly recurring template pattern, and the second template parameter (ToolSimpleState) would be the class name of the initial Smacc State</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;## Code a simple SMACC State</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;For the previous state machine, this would be the initial SMACC State. It also follows the Curiously recurrent template pattern. However, for Smacc states, the second template parameters is the so called &quot;Context&quot;, for this simple case, the context is the StateMachine type itself. However, that could also be other State (in a nexted-substate case) or an orthogonal line.</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;```cpp</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;struct ToolSimpleState</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    : SmaccState&lt;ToolSimpleState, SimpleStateMachine&gt;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;{</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;public:</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  using SmaccState::SmaccState;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  void onEntry()</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    ROS_INFO(&quot;Entering ToolSimpleState&quot;);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;};</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;int main(int argc, char **argv) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  // initialize the ros node</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  ros::init(argc, argv, &quot;example1&quot;);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  ros::NodeHandle nh;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  smacc::run&lt;SimpleStateMachine&gt;();</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;```</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;According to the UML statchart standard, things happens essencially when the system enters in the state, when the system exits the state and when some event is triggered. The two first ones are shown in this example. The c++ Constructor code is the place you have to write your &quot;entry code&quot;, the destructor is the place you have to write your &quot;exit code&quot;. The constructor parameter (my_context) is a reference to the context object (in this case the state machine). This kind of constructor may be verebosy, but is required to implement the rest of SMACC tasks and always follows the same pattern.</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;## Creating/accessing to SmaccComponents</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;Accessing to SMACC componets resources is one of the most important capabilities that SMACC provides. This example shows how to access to these resources form states.</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;For example, in this case we will asume we are in a state that controls the navigation of the vehicle, and it needs to access to the Ros Navigation Stack Action client and navigate to some position in the environment.</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;&lt;p align=&quot;center&quot;&gt;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;&lt;img src=&quot;https://raw.githubusercontent.com/brettpac/SMACC/master/documentation/shared_resource.png&quot; width=&quot;450&quot;/&gt;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;The code would be the following:</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;```cpp</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;struct Navigate : SmaccState&lt;Navigate, SimpleStateMachine&gt; </div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;public:</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  // This is the smacc component (it basically is a wrapper of the ROS Action Client for move base), please check the SMACC</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  // code to see how to implement your own action client</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  smacc::SmaccMoveBaseActionClient *moveBaseClient_;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  using SmaccState::SmaccState;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  void onEntry()</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    ROS_INFO(&quot;Entering Navigate&quot;);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    // this substate will need access to the &quot;MoveBase&quot; resource or plugin. In this line</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    // you get the reference to this resource.</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    this-&gt;requiresComponent(moveBaseClient_);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    goToEndPoint();</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  // auxiliar function that defines the motion that is requested to the move_base action server</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  void goToEndPoint() {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    geometry_msgs::PoseStamped radialStartPose = createInitialPose();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    smacc::SmaccMoveBaseActionClient::Goal goal;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    goal.target_pose.header.stamp = ros::Time::now();</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    goal.target_pose = radialStartPose;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    goal.target_pose.pose.position.x = 10;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    goal.target_pose.pose.position.y = 10;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    goal.target_pose.pose.orientation =</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        tf::createQuaternionMsgFromRollPitchYaw(0, 0, M_PI);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    moveBaseClient_-&gt;sendGoal(goal);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;};</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;```</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;## Simple State Transition on Action Result Event</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;According to the UML state machines standard, transitions between states happen on events. In SMACC events can be implemented by the user or happen</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;when Action Results callbacks and Action Feedback callbacks happen. In the following example we extend the previous example to transit to another state &#39;ExecuteToolState&#39; when the move_base</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;action sever returns a Result.</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;&lt;p align=&quot;center&quot;&gt;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;&lt;img src=&quot;https://raw.githubusercontent.com/brettpac/SMACC/master/documentation/action_result_transition.png&quot; width=&quot;450&quot;/&gt;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;The following would be the code to implement the diagram shown above.</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;```cpp</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;struct Navigate : SmaccState&lt;Navigate, SimpleStateMachine&gt;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;{</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;public:</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  // With this line we specify that we are going to react to any EvActionResult event</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  // generated by SMACC when the action server provides a response to our request</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  typedef mpl::list&lt;sc::transition&lt;EvActionResult&lt;SmaccMoveBaseActionClient::Result&gt;, ExecuteToolState&gt;&gt; reactions;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  using SmaccState::SmaccState;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  void onEntry()</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   [...]</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;};</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;struct ExecuteToolState : SmaccState&lt;ExecuteToolState, SimpleStateMachine&gt;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;{</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    using SmaccState::SmaccState;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    void onEntry()</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;};</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;```</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;## Add custom code on Action Result Events</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;In the following example, we want to add some code to the transition between the source state &quot;Navigate&quot; and the</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;destination state &quot;ExecuteToolState&quot;. This code may be any desired custom code (for example some transition guard).</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;This code is located in the react method</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;&lt;p align=&quot;center&quot;&gt;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;&lt;img src=&quot;https://raw.githubusercontent.com/brettpac/SMACC/master/documentation/custom_reaction.png&quot; width=&quot;450&quot;/&gt;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;The following would be the code for this state machine:</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;```cpp</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;struct Navigate : SmaccState&lt;Navigate, SimpleStateMachine&gt; </div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;{</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;public:</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  // With this line we specify that we are going to react to any EvActionResult event</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  // generated by SMACC when the action server provides a response to our request</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  typedef mpl::list&lt;sc::custom_reaction&lt;EvActionResult&lt;SmaccMoveBaseActionClient::Result&gt;&gt;&gt; reactions;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  using SmaccState::SmaccState;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  void onEntry()</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   [...]</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  // auxiliary function that defines the motion that is requested to the move_base action server</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  void goToEndPoint() {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   [...]</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  sc::result react(const EvActionResult&lt;SmaccMoveBaseActionClient::Result&gt; &amp;ev)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      // we only will react when the result is succeeded</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      if (ev.getResult() == actionlib::SimpleClientGoalState::SUCCEEDED)</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        // ev.resultMessage provides access to the move_base action server result structure</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        ROS_INFO(&quot;Received event to movebase: %s&quot;,ev.getResult().toString().c_str());</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        return transit&lt;ExecuteToolState&gt;();</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      else</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        return forward_event(); // do nothing, the default behavior if you do not specify any return value</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      } </div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;};</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;struct ExecuteToolState : SmaccState&lt;ExecuteToolState, SimpleStateMachine&gt; </div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;{</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    using SmaccState::SmaccState;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    void onEntry()</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;};</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;```</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;## Adding ROS Parameters to Smacc States</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;The SMACC states can be configured from the ros parameter server based on their hierarchy</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;and their class name. It is responsability of the user not to have two different state names at the same level (even if the namespace is distinct since the namespace is trimmed for parameters)</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;For example, imagine a StateMachine to move the mobile robot initially to some initial position, and then moving it to some other position relative to the initial position. You could put the navigation parameters in a ros configuration yaml file like this (and avoid hardcoding):</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;```yaml</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;MyStateMachine:</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    State1: #Go to some initial position</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        NavigationOrthogonalLine:</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            Navigate:</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                start_position_x: 3</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                start_position_y: 0</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    State2: #Go to some initial position</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        NavigationOrthogonalLine:</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            Navigate:</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                initial_orientation_index: 0 # the initial index of the linear motion (factor of angle_increment_degrees)</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                angle_increment_degree: 90    # the increment of angle between to linear motions</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                linear_trajectories_count: 2  # the number of linear trajectories of the radial </div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;```</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;Then, the c++ code for the State MyStateMachine/State1/NavigationOrthogonalLine/Navigate could contain the following parameter reading funcionality:</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;```cpp</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;struct Navigate : SmaccState&lt;Navigate, NavigationOrthogonalLine&gt; </div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;{</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;public:</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  using SmaccState::SmaccState;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  void onEntry()</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      geometry_msgs::Point p;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      param(&quot;start_position_x&quot;, p.x, 0);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      param(&quot;start_position_y&quot;, p.y, 0);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;}</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;```</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;The param template method reads from the parameters server delegating to the method defined ros::NodeHandle handle does but already located at the exact point in the parameter name hierarchy associated to this state. SMACC is also able have methods getParam and setParam that are delegated to ros::NodeHandle in the same way.</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;## Shared variables between states</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;This following example shows how to share a variable between two states. In the Navigate state the &quot;angle_value&quot; variable is set using the template method &quot;setData&quot;. Latter in the ExecuteToolState it gets the value using the template method &quot;getGlobalSMData&quot;.</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;```cpp</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;struct Navigate : SmaccState&lt;Navigate, SimpleStateMachine&gt;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;{</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;public:</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  using SmaccState::SmaccState;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  void onEntry()</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        double angle = M_PI;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        this-&gt;setGlobalSMData(&quot;angle_value&quot;, angle);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;};</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;struct ExecuteToolState : SmaccState&lt;ExecuteToolState, SimpleStateMachine&gt;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;{</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    using SmaccState::SmaccState;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    void onEntry()</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;         int angle;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;         this-&gt;getGlobalSMData(&quot;angle_value&quot;, angle);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;};</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;```</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;## Orthogonal Lines</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;SMACC proposes to work in different orthogonal lines: Navigation, Tool1, Tool2, etc. This example shows how you can define orthogonal lines in your SMACC code.</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;For example, we want to add two orthogonal lines: the navigation orthogonal line and the tool orthogonal line.</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;&lt;p align=&quot;center&quot;&gt;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;&lt;img src=&quot;https://raw.githubusercontent.com/brettpac/SMACC/master/documentation/orthogonal_lines.png&quot; width=&quot;450&quot;/&gt;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;First we will define the NavigationOrthogonal line line with a simple ToolSubState:</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;```cpp</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;struct NavigationOrthogonalLine</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    : SmaccState&lt;NavigationOrthogonalLine, SimpleStateMachine::orthogonal&lt;0&gt;, NavigateSubstate&gt; {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  using SmaccState::SmaccState;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  void onEntry()                 </div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    ROS_INFO(&quot;Entering in the navigation orthogonal line&quot;);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  ~NavigationOrthogonalLine() </div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    ROS_INFO(&quot;Finishing the navigation orthogonal line&quot;);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;};</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;struct NavigateSubstate : SmaccState&lt;NavigateSubstate, NavigationOrthogonalLine&gt; </div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;{</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    using SmaccState::SmaccState;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    void onEntry()</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;};</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;```</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;First we will define the ToolOthogonal line with a simple ToolSubState:</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;```cpp</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;struct ToolOrthogonalLine</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    : SmaccState&lt;ToolOrthogonalLine, SimpleStateMachine::orthogonal&lt;1&gt;, ToolSubstate&gt; {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;public:</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  using SmaccState::SmaccState;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  void onEntry()          </div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    ROS_INFO(&quot;Entering in the tool orthogonal line&quot;);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  ~ToolOrthogonalLine() </div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    ROS_INFO(&quot;Finishing the tool orthogonal line&quot;); </div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;};</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;struct ToolSubstate : SmaccState&lt;ToolSubstate, ToolOrthogonalLine&gt; </div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;{</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    using SmaccState::SmaccState;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    void onEntry()</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    {</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    }</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;};</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;```</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
